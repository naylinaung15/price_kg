<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thailand 3D Lottery - Enhanced Admin System</title>
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { 
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .lottery-ball {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ff6b6b, #ee5a52);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .admin-card {
            background: linear-gradient(145deg, #f0f0f0, #ffffff);
            box-shadow: 20px 20px 60px #d9d9d9, -20px -20px 60px #ffffff;
        }
        .banner-upload {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .banner-upload:hover {
            border-color: #667eea;
            background-color: #f8f9ff;
        }
        .number-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
        }
        .number-cell {
            width: 40px;
            height: 40px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .number-cell:hover {
            border-color: #667eea;
            background-color: #f0f4ff;
        }
        .number-cell.closed {
            background-color: #fee2e2;
            border-color: #dc2626;
            color: #dc2626;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success { background-color: #10b981; }
        .notification.error { background-color: #ef4444; }
        .notification.warning { background-color: #f59e0b; }
        .notification.info { background-color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-dice text-white text-2xl mr-3"></i>
                    <span class="text-white text-xl font-bold" id="navTitle">Thailand 3D Lottery</span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Language Selector -->
                    <select id="languageSelect" class="bg-white bg-opacity-20 text-white border border-white border-opacity-30 rounded px-3 py-1">
                        <option value="en">English</option>
                        <option value="my">မြန်မာ</option>
                        <option value="th">ไทย</option>
                    </select>
                    
                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="text-white hover:text-gray-300 transition-colors">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    
                    <!-- User Menu -->
                    <div class="relative">
                        <button id="userMenuBtn" class="flex items-center text-white hover:text-gray-300 transition-colors">
                            <i class="fas fa-user-circle text-2xl"></i>
                            <span class="ml-2" id="userNameDisplay">Guest</span>
                        </button>
                        <div id="userDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden">
                            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" onclick="showProfile()">
                                <i class="fas fa-user mr-2"></i><span data-translate="profile">Profile</span>
                            </a>
                            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" onclick="showWallet()">
                                <i class="fas fa-wallet mr-2"></i><span data-translate="wallet">Wallet</span>
                            </a>
                            <div class="border-t border-gray-100"></div>
                            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100" onclick="logout()">
                                <i class="fas fa-sign-out-alt mr-2"></i><span data-translate="logout">Logout</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Auth Section -->
        <div id="authSection" class="max-w-md mx-auto">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <div class="text-center mb-6">
                    <i class="fas fa-dice text-4xl text-purple-600 mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-800" data-translate="welcome">Welcome to Thailand 3D Lottery</h2>
                </div>
                
                <!-- Login Form -->
                <div id="loginForm">
                    <h3 class="text-xl font-semibold mb-4 text-center" data-translate="login">Login</h3>
                    <form onsubmit="login(event)">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="email">Email</label>
                            <input type="email" id="loginEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="password">Password</label>
                            <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        <button type="submit" class="w-full bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-sign-in-alt mr-2"></i><span data-translate="login">Login</span>
                        </button>
                    </form>
                    <div class="mt-4 text-center">
                        <button onclick="showRegisterForm()" class="text-purple-600 hover:text-purple-800" data-translate="createAccount">Create Account</button>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" class="hidden">
                    <h3 class="text-xl font-semibold mb-4 text-center" data-translate="register">Register</h3>
                    <form onsubmit="register(event)">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="fullName">Full Name</label>
                            <input type="text" id="registerName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="email">Email</label>
                            <input type="email" id="registerEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="phone">Phone Number</label>
                            <input type="tel" id="registerPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="password">Password</label>
                            <input type="password" id="registerPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-user-plus mr-2"></i><span data-translate="register">Register</span>
                        </button>
                    </form>
                    <div class="mt-4 text-center">
                        <button onclick="showLoginForm()" class="text-purple-600 hover:text-purple-800" data-translate="backToLogin">Back to Login</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App Section -->
        <div id="appSection" class="hidden">
            <!-- Banner Section -->
            <div id="bannerSection" class="mb-8">
                <div class="swiper-container relative overflow-hidden rounded-lg shadow-lg">
                    <div id="bannerSlider" class="flex transition-transform duration-500 ease-in-out">
                        <!-- Banners will be loaded here -->
                    </div>
                    <div class="absolute top-1/2 left-4 transform -translate-y-1/2">
                        <button onclick="previousBanner()" class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                    <div class="absolute top-1/2 right-4 transform -translate-y-1/2">
                        <button onclick="nextBanner()" class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="text-3xl text-blue-500 mr-4">
                            <i class="fas fa-tickets-alt"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm" data-translate="totalTickets">Total Tickets</p>
                            <p class="text-2xl font-bold" id="totalTickets">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="text-3xl text-green-500 mr-4">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm" data-translate="totalWinners">Total Winners</p>
                            <p class="text-2xl font-bold" id="totalWinners">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="text-3xl text-yellow-500 mr-4">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm" data-translate="totalPrize">Total Prize</p>
                            <p class="text-2xl font-bold" id="totalPrize">0 THB</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center">
                        <div class="text-3xl text-purple-500 mr-4">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm" data-translate="myBalance">My Balance</p>
                            <p class="text-2xl font-bold" id="userBalance">0 THB</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="bg-white rounded-lg shadow-lg mb-8">
                <div class="border-b border-gray-200">
                    <nav class="flex">
                        <button onclick="showTab('lottery')" class="tab-btn active py-4 px-6 text-purple-600 border-b-2 border-purple-600">
                            <i class="fas fa-dice mr-2"></i><span data-translate="lottery">Lottery</span>
                        </button>
                        <button onclick="showTab('results')" class="tab-btn py-4 px-6 text-gray-500 hover:text-purple-600">
                            <i class="fas fa-chart-line mr-2"></i><span data-translate="results">Results</span>
                        </button>
                        <button onclick="showTab('wallet')" class="tab-btn py-4 px-6 text-gray-500 hover:text-purple-600">
                            <i class="fas fa-wallet mr-2"></i><span data-translate="wallet">Wallet</span>
                        </button>
                        <button onclick="showTab('history')" class="tab-btn py-4 px-6 text-gray-500 hover:text-purple-600">
                            <i class="fas fa-history mr-2"></i><span data-translate="history">History</span>
                        </button>
                        <button id="adminTab" onclick="showTab('admin')" class="tab-btn py-4 px-6 text-gray-500 hover:text-purple-600 hidden">
                            <i class="fas fa-cog mr-2"></i><span data-translate="admin">Admin</span>
                        </button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div class="p-6">
                    <!-- Lottery Tab -->
                    <div id="lotteryTab" class="tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Next Draw Info -->
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg p-6 text-white">
                                <h3 class="text-xl font-bold mb-4" data-translate="nextDraw">Next Draw</h3>
                                <div class="mb-4">
                                    <p class="text-sm opacity-90" data-translate="drawDate">Draw Date</p>
                                    <p class="text-2xl font-bold" id="nextDrawDate">Loading...</p>
                                </div>
                                <div class="mb-4">
                                    <p class="text-sm opacity-90" data-translate="timeRemaining">Time Remaining</p>
                                    <p class="text-xl font-semibold" id="countdown">00:00:00</p>
                                </div>
                                <div>
                                    <p class="text-sm opacity-90" data-translate="jackpot">Jackpot Prize</p>
                                    <p class="text-3xl font-bold" id="jackpotAmount">500,000 THB</p>
                                </div>
                            </div>

                            <!-- Number Selection -->
                            <div class="bg-gray-50 rounded-lg p-6">
                                <h3 class="text-xl font-bold mb-4" data-translate="selectNumbers">Select Your Numbers</h3>
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="threeDNumber">3D Number (000-999)</label>
                                    <input type="number" id="selectedNumber" min="0" max="999" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Enter 3-digit number">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="betAmount">Bet Amount (THB)</label>
                                    <select id="betAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                                        <option value="10">10 THB</option>
                                        <option value="20">20 THB</option>
                                        <option value="50">50 THB</option>
                                        <option value="100">100 THB</option>
                                        <option value="200">200 THB</option>
                                        <option value="500">500 THB</option>
                                        <option value="1000">1000 THB</option>
                                    </select>
                                </div>
                                <button onclick="placeBet()" class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-ticket-alt mr-2"></i><span data-translate="placeBet">Place Bet</span>
                                </button>
                            </div>
                        </div>

                        <!-- Quick Pick Numbers -->
                        <div class="mt-8">
                            <h3 class="text-xl font-bold mb-4" data-translate="quickPick">Quick Pick Numbers</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                <button onclick="quickPick()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                                    <i class="fas fa-random mr-2"></i><span data-translate="randomNumber">Random</span>
                                </button>
                                <button onclick="aiPrediction()" class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors">
                                    <i class="fas fa-robot mr-2"></i><span data-translate="aiPrediction">AI Prediction</span>
                                </button>
                                <button onclick="hotNumbers()" class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">
                                    <i class="fas fa-fire mr-2"></i><span data-translate="hotNumbers">Hot Numbers</span>
                                </button>
                                <button onclick="coldNumbers()" class="bg-cyan-500 text-white py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors">
                                    <i class="fas fa-snowflake mr-2"></i><span data-translate="coldNumbers">Cold Numbers</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Results Tab -->
                    <div id="resultsTab" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Latest Results -->
                            <div>
                                <h3 class="text-xl font-bold mb-4" data-translate="latestResults">Latest Results</h3>
                                <div id="latestResults" class="space-y-4">
                                    <!-- Results will be loaded here -->
                                </div>
                            </div>

                            <!-- Results Chart -->
                            <div>
                                <h3 class="text-xl font-bold mb-4" data-translate="resultsChart">Results Chart</h3>
                                <canvas id="resultsChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <!-- Results History Table -->
                        <div class="mt-8">
                            <h3 class="text-xl font-bold mb-4" data-translate="resultsHistory">Results History</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white border border-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Draw No.</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Winning Number</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prize Amount</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Winners</th>
                                        </tr>
                                    </thead>
                                    <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Results will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Wallet Tab -->
                    <div id="walletTab" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Balance Info -->
                            <div class="bg-gradient-to-r from-green-500 to-blue-500 rounded-lg p-6 text-white">
                                <h3 class="text-xl font-bold mb-4" data-translate="walletBalance">Wallet Balance</h3>
                                <p class="text-4xl font-bold mb-2" id="walletBalance">0 THB</p>
                                <p class="text-sm opacity-90" data-translate="lastUpdated">Last updated: <span id="balanceLastUpdated">-</span></p>
                            </div>

                            <!-- Quick Actions -->
                            <div class="space-y-4">
                                <button onclick="showDepositModal()" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">
                                    <i class="fas fa-plus mr-2"></i><span data-translate="deposit">Deposit Money</span>
                                </button>
                                <button onclick="showWithdrawModal()" class="w-full bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">
                                    <i class="fas fa-minus mr-2"></i><span data-translate="withdraw">Withdraw Money</span>
                                </button>
                                <button onclick="refreshBalance()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-sync mr-2"></i><span data-translate="refreshBalance">Refresh Balance</span>
                                </button>
                            </div>
                        </div>

                        <!-- Transaction History -->
                        <div class="mt-8">
                            <h3 class="text-xl font-bold mb-4" data-translate="transactionHistory">Transaction History</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white border border-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactionTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Transactions will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- History Tab -->
                    <div id="historyTab" class="tab-content hidden">
                        <h3 class="text-xl font-bold mb-4" data-translate="myTickets">My Lottery Tickets</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Numbers</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bet Amount</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Draw Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prize</th>
                                    </tr>
                                </thead>
                                <tbody id="ticketTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Tickets will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Admin Tab -->
                    <div id="adminTab" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Admin Quick Stats -->
                            <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                <div class="admin-card rounded-lg p-6">
                                    <div class="flex items-center">
                                        <div class="text-3xl text-blue-500 mr-4">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div>
                                            <p class="text-gray-500 text-sm">Total Users</p>
                                            <p class="text-2xl font-bold" id="adminTotalUsers">0</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="admin-card rounded-lg p-6">
                                    <div class="flex items-center">
                                        <div class="text-3xl text-green-500 mr-4">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                        <div>
                                            <p class="text-gray-500 text-sm">Total Revenue</p>
                                            <p class="text-2xl font-bold" id="adminTotalRevenue">0 THB</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="admin-card rounded-lg p-6">
                                    <div class="flex items-center">
                                        <div class="text-3xl text-yellow-500 mr-4">
                                            <i class="fas fa-ticket-alt"></i>
                                        </div>
                                        <div>
                                            <p class="text-gray-500 text-sm">Active Tickets</p>
                                            <p class="text-2xl font-bold" id="adminActiveTickets">0</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="admin-card rounded-lg p-6">
                                    <div class="flex items-center">
                                        <div class="text-3xl text-red-500 mr-4">
                                            <i class="fas fa-ban"></i>
                                        </div>
                                        <div>
                                            <p class="text-gray-500 text-sm">Closed Numbers</p>
                                            <p class="text-2xl font-bold" id="adminClosedNumbers">0</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Banner Management -->
                            <div class="admin-card rounded-lg p-6">
                                <h3 class="text-xl font-bold mb-4">
                                    <i class="fas fa-images mr-2"></i>Banner Management
                                </h3>
                                <div class="banner-upload mb-4">
                                    <input type="file" id="bannerFile" accept="image/*" class="hidden" onchange="previewBanner(event)">
                                    <div onclick="document.getElementById('bannerFile').click()" class="cursor-pointer">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-600">Click to upload banner image</p>
                                        <p class="text-sm text-gray-400">PNG, JPG up to 10MB</p>
                                    </div>
                                </div>
                                <div id="bannerPreview" class="mb-4 hidden">
                                    <img id="bannerPreviewImg" class="w-full h-32 object-cover rounded-lg">
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="text" id="bannerTitle" placeholder="Banner Title" class="px-3 py-2 border border-gray-300 rounded">
                                    <input type="url" id="bannerLink" placeholder="Banner Link (optional)" class="px-3 py-2 border border-gray-300 rounded">
                                </div>
                                <button onclick="uploadBanner()" class="w-full mt-3 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-upload mr-2"></i>Upload Banner
                                </button>
                                
                                <!-- Active Banners -->
                                <div class="mt-6">
                                    <h4 class="font-semibold mb-3">Active Banners</h4>
                                    <div id="activeBanners" class="space-y-2">
                                        <!-- Banners will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Controls -->
                            <div class="admin-card rounded-lg p-6">
                                <h3 class="text-xl font-bold mb-4">
                                    <i class="fas fa-credit-card mr-2"></i>Payment Controls
                                </h3>
                                
                                <!-- Payment Settings -->
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm font-medium">Enable Deposits</label>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="enableDeposits" class="sr-only peer" checked onchange="toggleDeposits()">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm font-medium">Enable Withdrawals</label>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="enableWithdrawals" class="sr-only peer" checked onchange="toggleWithdrawals()">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Pending Transactions -->
                                <div class="mt-6">
                                    <h4 class="font-semibold mb-3">Pending Approvals</h4>
                                    <div id="pendingTransactions" class="space-y-2 max-h-60 overflow-y-auto">
                                        <!-- Pending transactions will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Number Management -->
                            <div class="admin-card rounded-lg p-6">
                                <h3 class="text-xl font-bold mb-4">
                                    <i class="fas fa-ban mr-2"></i>Number Management
                                </h3>
                                
                                <!-- Close Numbers -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">Close Specific Numbers</label>
                                    <div class="flex gap-2">
                                        <input type="number" id="closeNumberInput" min="0" max="999" placeholder="000-999" class="flex-1 px-3 py-2 border border-gray-300 rounded">
                                        <button onclick="closeNumber()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                                            <i class="fas fa-ban"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Single Digit Control -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">Single Digit Limits</label>
                                    <div class="number-grid">
                                        <div class="number-cell" data-digit="0" onclick="toggleDigit(0)">0</div>
                                        <div class="number-cell" data-digit="1" onclick="toggleDigit(1)">1</div>
                                        <div class="number-cell" data-digit="2" onclick="toggleDigit(2)">2</div>
                                        <div class="number-cell" data-digit="3" onclick="toggleDigit(3)">3</div>
                                        <div class="number-cell" data-digit="4" onclick="toggleDigit(4)">4</div>
                                        <div class="number-cell" data-digit="5" onclick="toggleDigit(5)">5</div>
                                        <div class="number-cell" data-digit="6" onclick="toggleDigit(6)">6</div>
                                        <div class="number-cell" data-digit="7" onclick="toggleDigit(7)">7</div>
                                        <div class="number-cell" data-digit="8" onclick="toggleDigit(8)">8</div>
                                        <div class="number-cell" data-digit="9" onclick="toggleDigit(9)">9</div>
                                    </div>
                                </div>

                                <!-- Closed Numbers List -->
                                <div>
                                    <h4 class="font-semibold mb-3">Closed Numbers</h4>
                                    <div id="closedNumbersList" class="max-h-40 overflow-y-auto">
                                        <!-- Closed numbers will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <!-- System Controls -->
                            <div class="lg:col-span-3 admin-card rounded-lg p-6">
                                <h3 class="text-xl font-bold mb-4">
                                    <i class="fas fa-cogs mr-2"></i>System Controls
                                </h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <!-- Lottery Controls -->
                                    <div>
                                        <h4 class="font-semibold mb-3">Lottery Controls</h4>
                                        <div class="space-y-2">
                                            <button onclick="startNewDraw()" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                                                <i class="fas fa-play mr-2"></i>Start New Draw
                                            </button>
                                            <button onclick="generateResults()" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                                                <i class="fas fa-random mr-2"></i>Generate Results
                                            </button>
                                            <button onclick="stopSales()" class="w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700">
                                                <i class="fas fa-stop mr-2"></i>Stop Sales
                                            </button>
                                        </div>
                                    </div>

                                    <!-- User Management -->
                                    <div>
                                        <h4 class="font-semibold mb-3">User Management</h4>
                                        <div class="space-y-2">
                                            <button onclick="viewAllUsers()" class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700">
                                                <i class="fas fa-users mr-2"></i>View All Users
                                            </button>
                                            <button onclick="exportUserData()" class="w-full bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700">
                                                <i class="fas fa-download mr-2"></i>Export Data
                                            </button>
                                            <button onclick="sendNotification()" class="w-full bg-yellow-600 text-white py-2 px-4 rounded hover:bg-yellow-700">
                                                <i class="fas fa-bell mr-2"></i>Send Notification
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Reports -->
                                    <div>
                                        <h4 class="font-semibold mb-3">Reports & Analytics</h4>
                                        <div class="space-y-2">
                                            <button onclick="generateDailyReport()" class="w-full bg-cyan-600 text-white py-2 px-4 rounded hover:bg-cyan-700">
                                                <i class="fas fa-chart-bar mr-2"></i>Daily Report
                                            </button>
                                            <button onclick="generateMonthlyReport()" class="w-full bg-teal-600 text-white py-2 px-4 rounded hover:bg-teal-700">
                                                <i class="fas fa-chart-line mr-2"></i>Monthly Report
                                            </button>
                                            <button onclick="viewAnalytics()" class="w-full bg-orange-600 text-white py-2 px-4 rounded hover:bg-orange-700">
                                                <i class="fas fa-analytics mr-2"></i>Analytics
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Deposit Modal -->
    <div id="depositModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Deposit Money</h3>
                <button onclick="closeDepositModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form onsubmit="submitDeposit(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Amount (THB)</label>
                    <input type="number" id="depositAmount" min="10" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Payment Method</label>
                    <select id="depositMethod" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="bank">Bank Transfer</option>
                        <option value="card">Credit/Debit Card</option>
                        <option value="wallet">Digital Wallet</option>
                    </select>
                </div>
                <div class="flex gap-4">
                    <button type="button" onclick="closeDepositModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400">Cancel</button>
                    <button type="submit" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">Deposit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Withdraw Money</h3>
                <button onclick="closeWithdrawModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form onsubmit="submitWithdraw(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Amount (THB)</label>
                    <input type="number" id="withdrawAmount" min="10" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Bank Account</label>
                    <input type="text" id="bankAccount" placeholder="Bank account number" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Bank Name</label>
                    <select id="bankName" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="scb">Siam Commercial Bank</option>
                        <option value="kbank">Kasikorn Bank</option>
                        <option value="bbl">Bangkok Bank</option>
                        <option value="tmb">TMB Bank</option>
                    </select>
                </div>
                <div class="flex gap-4">
                    <button type="button" onclick="closeWithdrawModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400">Cancel</button>
                    <button type="submit" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700">Withdraw</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- AI Chat Widget -->
    <div id="aiChatWidget" class="fixed bottom-4 right-4 z-50">
        <button onclick="toggleAIChat()" class="bg-purple-600 text-white p-4 rounded-full shadow-lg hover:bg-purple-700 transition-colors">
            <i class="fas fa-robot text-xl"></i>
        </button>
        <div id="aiChatBox" class="hidden absolute bottom-16 right-0 w-80 h-96 bg-white rounded-lg shadow-xl border">
            <div class="bg-purple-600 text-white p-4 rounded-t-lg">
                <div class="flex justify-between items-center">
                    <h4 class="font-semibold">AI Assistant</h4>
                    <button onclick="toggleAIChat()" class="text-white hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="aiChatMessages" class="h-72 overflow-y-auto p-4 space-y-2">
                <div class="bg-gray-100 p-3 rounded-lg">
                    <p class="text-sm">Hello! I'm your AI assistant. How can I help you with the lottery today?</p>
                </div>
            </div>
            <div class="p-4 border-t">
                <div class="flex gap-2">
                    <input type="text" id="aiChatInput" placeholder="Ask me anything..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <button onclick="sendAIMessage()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
       // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB49vRPX8YaWuTP5GS3lsBDqdAaz_hJYAw",
            authDomain: "onlineshop-849c8.firebaseapp.com",
            databaseURL: "https://onlineshop-849c8.firebaseio.com",
            projectId: "onlineshop-849c8",
            storageBucket: "onlineshop-849c8.appspot.com",
            messagingSenderId: "883512833370",
            appId: "1:883512833370:web:a1c8412b158f8744afef63"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global Variables
        let currentUser = null;
        let isAdmin = false;
        let currentLanguage = 'en';
        let currentBannerIndex = 0;
        let bannerInterval;
        let closedNumbers = new Set();
        let closedDigits = new Set();
        let depositsEnabled = true;
        let withdrawalsEnabled = true;

        // Language Translations
        const translations = {
            en: {
                welcome: "Welcome to Thailand 3D Lottery",
                login: "Login",
                register: "Register",
                email: "Email",
                password: "Password",
                fullName: "Full Name",
                phone: "Phone Number",
                createAccount: "Create Account",
                backToLogin: "Back to Login",
                profile: "Profile",
                wallet: "Wallet",
                logout: "Logout",
                lottery: "Lottery",
                results: "Results",
                history: "History",
                admin: "Admin",
                nextDraw: "Next Draw",
                drawDate: "Draw Date",
                timeRemaining: "Time Remaining",
                jackpot: "Jackpot Prize",
                selectNumbers: "Select Your Numbers",
                threeDNumber: "3D Number (000-999)",
                betAmount: "Bet Amount (THB)",
                placeBet: "Place Bet",
                quickPick: "Quick Pick Numbers",
                randomNumber: "Random",
                aiPrediction: "AI Prediction",
                hotNumbers: "Hot Numbers",
                coldNumbers: "Cold Numbers",
                latestResults: "Latest Results",
                resultsChart: "Results Chart",
                resultsHistory: "Results History",
                walletBalance: "Wallet Balance",
                lastUpdated: "Last updated",
                deposit: "Deposit Money",
                withdraw: "Withdraw Money",
                refreshBalance: "Refresh Balance",
                transactionHistory: "Transaction History",
                myTickets: "My Lottery Tickets",
                totalTickets: "Total Tickets",
                totalWinners: "Total Winners",
                totalPrize: "Total Prize",
                myBalance: "My Balance"
            },
            my: {
                welcome: "ထိုင်း 3D လော့ထရီသို့ ကြိုဆိုပါသည်",
                login: "ဝင်ရောက်ရန်",
                register: "မှတ်ပုံတင်ရန်",
                email: "အီးမေး",
                password: "စကားဝှက်",
                fullName: "အမည်အပြည့်အစုံ",
                phone: "ဖုန်းနံပါတ်",
                createAccount: "အကောင့်ဖွင့်ရန်",
                backToLogin: "လော့ဂ်အင်သို့ပြန်သွား",
                profile: "ပရိုဖိုင်",
                wallet: "ပိုက်ဆံအိတ်",
                logout: "ထွက်ရန်",
                lottery: "လော့ထရီ",
                results: "ရလဒ်များ",
                history: "မှတ်တမ်း",
                admin: "စီမံခန့်ခွဲမှု",
                nextDraw: "နောက်ထွက်ပွဲ",
                drawDate: "ထွက်ပွဲရက်စွဲ",
                timeRemaining: "ကျန်ရှိသောအချိန်",
                jackpot: "ဂျက်ပို့ဆုကြေး",
                selectNumbers: "သင့်နံပါတ်များရွေးချယ်ပါ",
                threeDNumber: "3D နံပါတ် (000-999)",
                betAmount: "လောင်းကြေး (THB)",
                placeBet: "လောင်းထားရန်",
                quickPick: "မြန်နံပါတ်ရွေး",
                randomNumber: "ကျပန်း",
                aiPrediction: "AI ခန့်မှန်းချက်",
                hotNumbers: "ပူနံပါတ်များ",
                coldNumbers: "အေးနံပါတ်များ",
                latestResults: "နောက်ဆုံးရလဒ်များ",
                resultsChart: "ရလဒ်ဇယား",
                resultsHistory: "ရလဒ်မှတ်တမ်း",
                walletBalance: "ပိုက်ဆံအိတ်လက်ကျန်",
                lastUpdated: "နောက်ဆုံးအပ်ဒိတ်",
                deposit: "ငွေသွင်းရန်",
                withdraw: "ငွေထုတ်ရန်",
                refreshBalance: "လက်ကျန်ပြန်လည်စစ်ဆေးရန်",
                transactionHistory: "ငွေကြေးလုပ်ငန်းမှတ်တမ်း",
                myTickets: "ကျွန်ုပ်၏လော့ထရီလက်မှတ်များ",
                totalTickets: "စုစုပေါင်းလက်မှတ်များ",
                totalWinners: "စုစုပေါင်းအနိုင်ရသူများ",
                totalPrize: "စုစုပေါင်းဆုကြေး",
                myBalance: "ကျွန်ုပ်၏လက်ကျန်"
            },
            th: {
                welcome: "ยินดีต้อนรับสู่หวย 3D ไทย",
                login: "เข้าสู่ระบบ",
                register: "สมัครสมาชิก",
                email: "อีเมล",
                password: "รหัสผ่าน",
                fullName: "ชื่อ-นามสกุล",
                phone: "หมายเลขโทรศัพท์",
                createAccount: "สร้างบัญชี",
                backToLogin: "กลับไปหน้าเข้าสู่ระบบ",
                profile: "โปรไฟล์",
                wallet: "กระเป๋าเงิน",
                logout: "ออกจากระบบ",
                lottery: "หวย",
                results: "ผลรางวัล",
                history: "ประวัติ",
                admin: "แอดมิน",
                nextDraw: "งวดต่อไป",
                drawDate: "วันที่ออกรางวัล",
                timeRemaining: "เวลาที่เหลือ",
                jackpot: "รางวัลแจ็คพอต",
                selectNumbers: "เลือกหมายเลขของคุณ",
                threeDNumber: "หมายเลข 3D (000-999)",
                betAmount: "จำนวนเงินเดิมพัน (บาท)",
                placeBet: "วางเดิมพัน",
                quickPick: "เลือกหมายเลขด่วน",
                randomNumber: "สุ่ม",
                aiPrediction: "คาดการณ์ AI",
                hotNumbers: "หมายเลขร้อน",
                coldNumbers: "หมายเลขเย็น",
                latestResults: "ผลรางวัลล่าสุด",
                resultsChart: "กราฟผลรางวัล",
                resultsHistory: "ประวัติผลรางวัล",
                walletBalance: "ยอดเงินในกระเป๋า",
                lastUpdated: "อัพเดทล่าสุด",
                deposit: "ฝากเงิน",
                withdraw: "ถอนเงิน",
                refreshBalance: "รีเฟรชยอดเงิน",
                transactionHistory: "ประวัติการทำธุรกรรม",
                myTickets: "ลอตเตอรี่ของฉัน",
                totalTickets: "ลอตเตอรี่ทั้งหมด",
                totalWinners: "ผู้ชนะทั้งหมด",
                totalPrize: "รางวัลทั้งหมด",
                myBalance: "ยอดเงินของฉัน"
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadLanguage();
            loadBanners();
            startCountdown();
            loadSystemSettings();
        });

        // Auth State Observer
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                checkUserRole();
                showApp();
                loadUserData();
            } else {
                currentUser = null;
                isAdmin = false;
                showAuth();
            }
        });

        // Initialize Application
        function initializeApp() {
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
            
            // Load saved language
            const savedLanguage = localStorage.getItem('language') || 'en';
            currentLanguage = savedLanguage;
            document.getElementById('languageSelect').value = savedLanguage;
            
            // Initialize event listeners
            document.getElementById('languageSelect').addEventListener('change', changeLanguage);
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('userMenuBtn').addEventListener('click', toggleUserMenu);
            
            // Click outside to close dropdown
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#userMenuBtn')) {
                    document.getElementById('userDropdown').classList.add('hidden');
                }
            });
        }

        // Authentication Functions
        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showNotification('Login successful!', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function register(event) {
            event.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Save user profile
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    phone: phone,
                    balance: 0,
                    role: 'user',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification('Registration successful!', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                showNotification('Logged out successfully!', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // User Role Check
        async function checkUserRole() {
            if (currentUser) {
                try {
                    const userDoc = await db.collection('users').doc(currentUser.uid).get();
                    const userData = userDoc.data();
                    
                    if (userData && userData.role === 'admin') {
                        isAdmin = true;
                        document.getElementById('adminTab').classList.remove('hidden');
                    } else {
                        isAdmin = false;
                        document.getElementById('adminTab').classList.add('hidden');
                    }
                    
                    document.getElementById('userNameDisplay').textContent = userData?.name || currentUser.email;
                } catch (error) {
                    console.error('Error checking user role:', error);
                }
            }
        }

        // UI Functions
        function showAuth() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('appSection').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('appSection').classList.remove('hidden');
        }

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('hidden');
        }

        // Tab Functions
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.add('hidden'));
            
            // Remove active class from all tab buttons
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.classList.remove('active', 'text-purple-600', 'border-purple-600');
                btn.classList.add('text-gray-500');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Add active class to selected tab button
            event.target.classList.add('active', 'text-purple-600', 'border-purple-600');
            event.target.classList.remove('text-gray-500');
            
            // Load tab-specific data
            switch(tabName) {
                case 'results':
                    loadResults();
                    loadResultsChart();
                    break;
                case 'wallet':
                    loadWallet();
                    break;
                case 'history':
                    loadHistory();
                    break;
                case 'admin':
                    if (isAdmin) {
                        loadAdminData();
                    }
                    break;
            }
        }

        // Language Functions
        function changeLanguage() {
            currentLanguage = document.getElementById('languageSelect').value;
            localStorage.setItem('language', currentLanguage);
            loadLanguage();
        }

        function loadLanguage() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
        }

        // Theme Functions
        function toggleTheme() {
            const currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        }

        function applyTheme(theme) {
            const themeIcon = document.getElementById('themeIcon');
            if (theme === 'dark') {
                document.body.classList.add('dark');
                themeIcon.className = 'fas fa-sun';
            } else {
                document.body.classList.remove('dark');
                themeIcon.className = 'fas fa-moon';
            }
        }

        // Banner Functions
        async function loadBanners() {
            try {
                const bannersSnapshot = await db.collection('banners').where('active', '==', true).orderBy('order').get();
                const banners = bannersSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                if (banners.length > 0) {
                    displayBanners(banners);
                    startBannerSlider();
                } else {
                    // Show default banner
                    document.getElementById('bannerSlider').innerHTML = `
                        <div class="w-full h-48 bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white">
                            <div class="text-center">
                                <h2 class="text-3xl font-bold mb-2">Thailand 3D Lottery</h2>
                                <p class="text-xl">Win up to 500,000 THB!</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading banners:', error);
            }
        }

        function displayBanners(banners) {
            const bannerSlider = document.getElementById('bannerSlider');
            bannerSlider.innerHTML = banners.map(banner => `
                <div class="w-full h-48 flex-shrink-0 relative">
                    <img src="${banner.imageUrl}" alt="${banner.title}" class="w-full h-full object-cover">
                    ${banner.link ? `<a href="${banner.link}" class="absolute inset-0"></a>` : ''}
                    <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-4">
                        <h3 class="text-xl font-bold">${banner.title}</h3>
                    </div>
                </div>
            `).join('');
        }

        function startBannerSlider() {
            const banners = document.querySelectorAll('#bannerSlider > div');
            if (banners.length > 1) {
                bannerInterval = setInterval(() => {
                    nextBanner();
                }, 5000);
            }
        }

        function nextBanner() {
            const bannerSlider = document.getElementById('bannerSlider');
            const banners = bannerSlider.children;
            if (banners.length > 1) {
                currentBannerIndex = (currentBannerIndex + 1) % banners.length;
                bannerSlider.style.transform = `translateX(-${currentBannerIndex * 100}%)`;
            }
        }

        function previousBanner() {
            const bannerSlider = document.getElementById('bannerSlider');
            const banners = bannerSlider.children;
            if (banners.length > 1) {
                currentBannerIndex = currentBannerIndex === 0 ? banners.length - 1 : currentBannerIndex - 1;
                bannerSlider.style.transform = `translateX(-${currentBannerIndex * 100}%)`;
            }
        }

        // Admin Banner Functions
        function previewBanner(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('bannerPreviewImg').src = e.target.result;
                    document.getElementById('bannerPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        async function uploadBanner() {
            const file = document.getElementById('bannerFile').files[0];
            const title = document.getElementById('bannerTitle').value;
            const link = document.getElementById('bannerLink').value;
            
            if (!file || !title) {
                showNotification('Please select a file and enter a title', 'error');
                return;
            }
            
            try {
                // Upload image to Firebase Storage
                const storageRef = storage.ref().child(`banners/${Date.now()}_${file.name}`);
                const snapshot = await storageRef.put(file);
                const imageUrl = await snapshot.ref.getDownloadURL();
                
                // Save banner to Firestore
                await db.collection('banners').add({
                    title: title,
                    imageUrl: imageUrl,
                    link: link || null,
                    active: true,
                    order: Date.now(),
                    createdBy: currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification('Banner uploaded successfully!', 'success');
                
                // Clear form
                document.getElementById('bannerFile').value = '';
                document.getElementById('bannerTitle').value = '';
                document.getElementById('bannerLink').value = '';
                document.getElementById('bannerPreview').classList.add('hidden');
                
                // Reload banners
                loadBanners();
                loadActiveBanners();
                
            } catch (error) {
                showNotification('Error uploading banner: ' + error.message, 'error');
            }
        }

        async function loadActiveBanners() {
            if (!isAdmin) return;
            
            try {
                const bannersSnapshot = await db.collection('banners').orderBy('createdAt', 'desc').get();
                const banners = bannersSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                const activeBannersDiv = document.getElementById('activeBanners');
                activeBannersDiv.innerHTML = banners.map(banner => `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                        <div class="flex items-center">
                            <img src="${banner.imageUrl}" alt="${banner.title}" class="w-12 h-8 object-cover rounded mr-2">
                            <span class="text-sm">${banner.title}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" ${banner.active ? 'checked' : ''} class="sr-only peer" onchange="toggleBanner('${banner.id}', this.checked)">
                                <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                            <button onclick="deleteBanner('${banner.id}')" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading active banners:', error);
            }
        }

        async function toggleBanner(bannerId, active) {
            try {
                await db.collection('banners').doc(bannerId).update({
                    active: active
                });
                showNotification(`Banner ${active ? 'activated' : 'deactivated'}`, 'success');
                loadBanners();
            } catch (error) {
                showNotification('Error updating banner: ' + error.message, 'error');
            }
        }

        async function deleteBanner(bannerId) {
            if (confirm('Are you sure you want to delete this banner?')) {
                try {
                    await db.collection('banners').doc(bannerId).delete();
                    showNotification('Banner deleted successfully', 'success');
                    loadActiveBanners();
                    loadBanners();
                } catch (error) {
                    showNotification('Error deleting banner: ' + error.message, 'error');
                }
            }
        }

        // Payment Control Functions
        async function toggleDeposits() {
            const enabled = document.getElementById('enableDeposits').checked;
            depositsEnabled = enabled;
            
            try {
                await db.collection('system_settings').doc('payments').set({
                    depositsEnabled: enabled
                }, { merge: true });
                
                showNotification(`Deposits ${enabled ? 'enabled' : 'disabled'}`, 'success');
            } catch (error) {
                showNotification('Error updating deposit settings: ' + error.message, 'error');
            }
        }

        async function toggleWithdrawals() {
            const enabled = document.getElementById('enableWithdrawals').checked;
            withdrawalsEnabled = enabled;
            
            try {
                await db.collection('system_settings').doc('payments').set({
                    withdrawalsEnabled: enabled
                }, { merge: true });
                
                showNotification(`Withdrawals ${enabled ? 'enabled' : 'disabled'}`, 'success');
            } catch (error) {
                showNotification('Error updating withdrawal settings: ' + error.message, 'error');
            }
        }

        async function loadSystemSettings() {
            try {
                const settingsDoc = await db.collection('system_settings').doc('payments').get();
                const settings = settingsDoc.data();
                
                if (settings) {
                    depositsEnabled = settings.depositsEnabled !== false;
                    withdrawalsEnabled = settings.withdrawalsEnabled !== false;
                    
                    if (isAdmin) {
                        document.getElementById('enableDeposits').checked = depositsEnabled;
                        document.getElementById('enableWithdrawals').checked = withdrawalsEnabled;
                    }
                }
                
                // Load closed numbers
                const numbersDoc = await db.collection('system_settings').doc('closed_numbers').get();
                const numbersData = numbersDoc.data();
                
                if (numbersData) {
                    closedNumbers = new Set(numbersData.numbers || []);
                    closedDigits = new Set(numbersData.digits || []);
                    updateClosedNumbersDisplay();
                }
                
            } catch (error) {
                console.error('Error loading system settings:', error);
            }
        }

        async function loadPendingTransactions() {
            if (!isAdmin) return;
            
            try {
                const transactionsSnapshot = await db.collection('transactions')
                    .where('status', '==', 'pending')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                const transactions = transactionsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                const pendingDiv = document.getElementById('pendingTransactions');
                if (transactions.length === 0) {
                    pendingDiv.innerHTML = '<p class="text-gray-500 text-sm">No pending transactions</p>';
                } else {
                    pendingDiv.innerHTML = transactions.map(transaction => `
                        <div class="flex items-center justify-between p-2 bg-yellow-50 rounded">
                            <div>
                                <p class="text-sm font-medium">${transaction.type} - ${transaction.amount} THB</p>
                                <p class="text-xs text-gray-600">${transaction.userEmail}</p>
                            </div>
                            <div class="flex space-x-1">
                                <button onclick="approveTransaction('${transaction.id}')" class="bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="rejectTransaction('${transaction.id}')" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading pending transactions:', error);
            }
        }

        async function approveTransaction(transactionId) {
            try {
                await db.collection('transactions').doc(transactionId).update({
                    status: 'approved',
                    approvedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    approvedBy: currentUser.uid
                });
                
                showNotification('Transaction approved', 'success');
                loadPendingTransactions();
            } catch (error) {
                showNotification('Error approving transaction: ' + error.message, 'error');
            }
        }

        async function rejectTransaction(transactionId) {
            if (confirm('Are you sure you want to reject this transaction?')) {
                try {
                    await db.collection('transactions').doc(transactionId).update({
                        status: 'rejected',
                        rejectedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        rejectedBy: currentUser.uid
                    });
                    
                    showNotification('Transaction rejected', 'success');
                    loadPendingTransactions();
                } catch (error) {
                    showNotification('Error rejecting transaction: ' + error.message, 'error');
                }
            }
        }

        // Number Management Functions
        async function closeNumber() {
            const numberInput = document.getElementById('closeNumberInput');
            const number = numberInput.value.padStart(3, '0');
            
            if (number < 0 || number > 999) {
                showNotification('Please enter a valid number (000-999)', 'error');
                return;
            }
            
            closedNumbers.add(number);
            await updateClosedNumbers();
            numberInput.value = '';
            updateClosedNumbersDisplay();
            showNotification(`Number ${number} closed`, 'success');
        }

        function toggleDigit(digit) {
            const digitCell = document.querySelector(`[data-digit="${digit}"]`);
            
            if (closedDigits.has(digit)) {
                closedDigits.delete(digit);
                digitCell.classList.remove('closed');
            } else {
                closedDigits.add(digit);
                digitCell.classList.add('closed');
            }
            
            updateClosedNumbers();
        }

        async function updateClosedNumbers() {
            try {
                await db.collection('system_settings').doc('closed_numbers').set({
                    numbers: Array.from(closedNumbers),
                    digits: Array.from(closedDigits),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: currentUser.uid
                });
            } catch (error) {
                console.error('Error updating closed numbers:', error);
            }
        }

        function updateClosedNumbersDisplay() {
            // Update closed numbers list
            const closedNumbersList = document.getElementById('closedNumbersList');
            if (closedNumbersList) {
                if (closedNumbers.size === 0) {
                    closedNumbersList.innerHTML = '<p class="text-gray-500 text-sm">No closed numbers</p>';
                } else {
                    closedNumbersList.innerHTML = Array.from(closedNumbers).map(number => `
                        <span class="inline-block bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-1 mb-1">
                            ${number}
                            <button onclick="reopenNumber('${number}')" class="ml-1 text-red-600 hover:text-red-800">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                    `).join('');
                }
            }
            
            // Update digit cells
            for (let i = 0; i <= 9; i++) {
                const digitCell = document.querySelector(`[data-digit="${i}"]`);
                if (digitCell) {
                    if (closedDigits.has(i)) {
                        digitCell.classList.add('closed');
                    } else {
                        digitCell.classList.remove('closed');
                    }
                }
            }
            
            // Update admin stats
            const adminClosedNumbers = document.getElementById('adminClosedNumbers');
            if (adminClosedNumbers) {
                adminClosedNumbers.textContent = closedNumbers.size;
            }
        }

        async function reopenNumber(number) {
            closedNumbers.delete(number);
            await updateClosedNumbers();
            updateClosedNumbersDisplay();
            showNotification(`Number ${number} reopened`, 'success');
        }

        // Lottery Functions
        async function placeBet() {
            const selectedNumber = document.getElementById('selectedNumber').value;
            const betAmount = parseInt(document.getElementById('betAmount').value);
            
            if (!selectedNumber || selectedNumber.length !== 3) {
                showNotification('Please enter a valid 3-digit number', 'error');
                return;
            }
            
            const paddedNumber = selectedNumber.padStart(3, '0');
            
            // Check if number is closed
            if (closedNumbers.has(paddedNumber)) {
                showNotification(`Number ${paddedNumber} is currently closed for betting`, 'error');
                return;
            }
            
            // Check if any digit is closed
            for (let digit of paddedNumber) {
                if (closedDigits.has(parseInt(digit))) {
                    showNotification(`Digit ${digit} is currently restricted`, 'error');
                    return;
                }
            }
            
            // Check user balance
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            const userData = userDoc.data();
            
            if (userData.balance < betAmount) {
                showNotification('Insufficient balance. Please deposit money first.', 'error');
                return;
            }
            
            try {
                // Create ticket
                await db.collection('tickets').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    number: paddedNumber,
                    betAmount: betAmount,
                    status: 'active',
                    drawDate: getNextDrawDate(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update user balance
                await db.collection('users').doc(currentUser.uid).update({
                    balance: firebase.firestore.FieldValue.increment(-betAmount)
                });
                
                // Create transaction record
                await db.collection('transactions').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    type: 'bet',
                    amount: betAmount,
                    description: `Bet on number ${paddedNumber}`,
                    status: 'completed',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification(`Bet placed successfully! Number: ${paddedNumber}, Amount: ${betAmount} THB`, 'success');
                
                // Clear form
                document.getElementById('selectedNumber').value = '';
                
                // Refresh user data
                loadUserData();
                
            } catch (error) {
                showNotification('Error placing bet: ' + error.message, 'error');
            }
        }

        function getNextDrawDate() {
            const now = new Date();
            const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
            return nextMonth;
        }

        function quickPick() {
            const randomNumber = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            document.getElementById('selectedNumber').value = randomNumber;
        }

        function aiPrediction() {
            // Simple AI prediction based on historical data (mock implementation)
            const predictions = ['123', '456', '789', '234', '567', '890', '345', '678', '901'];
            const randomPrediction = predictions[Math.floor(Math.random() * predictions.length)];
            document.getElementById('selectedNumber').value = randomPrediction;
            showNotification('AI has predicted a lucky number for you!', 'info');
        }

        function hotNumbers() {
            // Mock hot numbers (in real implementation, this would be based on statistical analysis)
            const hotNumbers = ['111', '222', '333', '444', '555'];
            const randomHot = hotNumbers[Math.floor(Math.random() * hotNumbers.length)];
            document.getElementById('selectedNumber').value = randomHot;
            showNotification('Hot number selected!', 'info');
        }

        function coldNumbers() {
            // Mock cold numbers (in real implementation, this would be based on statistical analysis)
            const coldNumbers = ['013', '269', '478', '156', '037'];
            const randomCold = coldNumbers[Math.floor(Math.random() * coldNumbers.length)];
            document.getElementById('selectedNumber').value = randomCold;
            showNotification('Cold number selected!', 'info');
        }

        // Countdown Timer
        function startCountdown() {
            setInterval(updateCountdown, 1000);
        }

        function updateCountdown() {
            const nextDraw = getNextDrawDate();
            const now = new Date();
            const diff = nextDraw - now;
            
            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                document.getElementById('nextDrawDate').textContent = nextDraw.toLocaleDateString();
            } else {
                document.getElementById('countdown').textContent = 'Draw in progress...';
            }
        }

        // Wallet Functions
        function showDepositModal() {
            if (!depositsEnabled) {
                showNotification('Deposits are currently disabled', 'warning');
                return;
            }
            document.getElementById('depositModal').classList.remove('hidden');
            document.getElementById('depositModal').classList.add('flex');
        }

        function closeDepositModal() {
            document.getElementById('depositModal').classList.add('hidden');
            document.getElementById('depositModal').classList.remove('flex');
        }

        function showWithdrawModal() {
            if (!withdrawalsEnabled) {
                showNotification('Withdrawals are currently disabled', 'warning');
                return;
            }
            document.getElementById('withdrawModal').classList.remove('hidden');
            document.getElementById('withdrawModal').classList.add('flex');
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.add('hidden');
            document.getElementById('withdrawModal').classList.remove('flex');
        }

        async function submitDeposit(event) {
            event.preventDefault();
            const amount = parseInt(document.getElementById('depositAmount').value);
            const method = document.getElementById('depositMethod').value;
            
            try {
                await db.collection('transactions').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    type: 'deposit',
                    amount: amount,
                    method: method,
                    status: 'pending',
                    description: `Deposit via ${method}`,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification('Deposit request submitted! Waiting for admin approval.', 'success');
                closeDepositModal();
                
            } catch (error) {
                showNotification('Error submitting deposit: ' + error.message, 'error');
            }
        }

        async function submitWithdraw(event) {
            event.preventDefault();
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const bankAccount = document.getElementById('bankAccount').value;
            const bankName = document.getElementById('bankName').value;
            
            // Check user balance
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            const userData = userDoc.data();
            
            if (userData.balance < amount) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            
            try {
                await db.collection('transactions').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    type: 'withdrawal',
                    amount: amount,
                    bankAccount: bankAccount,
                    bankName: bankName,
                    status: 'pending',
                    description: `Withdrawal to ${bankName}`,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification('Withdrawal request submitted! Waiting for admin approval.', 'success');
                closeWithdrawModal();
                
            } catch (error) {
                showNotification('Error submitting withdrawal: ' + error.message, 'error');
            }
        }

        async function refreshBalance() {
            await loadUserData();
            showNotification('Balance refreshed!', 'success');
        }

        // Data Loading Functions
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                if (userData) {
                    document.getElementById('userBalance').textContent = `${userData.balance || 0} THB`;
                    document.getElementById('walletBalance').textContent = `${userData.balance || 0} THB`;
                    document.getElementById('balanceLastUpdated').textContent = new Date().toLocaleString();
                }
                
                // Load user stats
                const ticketsSnapshot = await db.collection('tickets').where('userId', '==', currentUser.uid).get();
                document.getElementById('totalTickets').textContent = ticketsSnapshot.size;
                
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function loadResults() {
            try {
                const resultsSnapshot = await db.collection('results').orderBy('drawDate', 'desc').limit(10).get();
                const results = resultsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                // Display latest results
                const latestResultsDiv = document.getElementById('latestResults');
                if (results.length === 0) {
                    latestResultsDiv.innerHTML = '<p class="text-gray-500">No results available yet</p>';
                } else {
                    latestResultsDiv.innerHTML = results.slice(0, 3).map(result => `
                        <div class="bg-white p-4 rounded-lg shadow border">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-semibold">Draw #${result.drawNumber}</h4>
                                    <p class="text-sm text-gray-600">${result.drawDate?.toDate().toLocaleDateString()}</p>
                                </div>
                                <div class="lottery-ball">
                                    ${result.winningNumber}
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
                
                // Display results table
                const resultsTableBody = document.getElementById('resultsTableBody');
                resultsTableBody.innerHTML = results.map(result => `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${result.drawDate?.toDate().toLocaleDateString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            #${result.drawNumber}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                                ${result.winningNumber}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${result.prizeAmount?.toLocaleString()} THB
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${result.winnersCount || 0}
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading results:', error);
            }
        }

        function loadResultsChart() {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            // Mock data for chart
            const chartData = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Winners',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                    borderColor: 'rgba(99, 102, 241, 1)',
                    borderWidth: 2
                }]
            };
            
            new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        async function loadWallet() {
            if (!currentUser) return;
            
            try {
                // Load transactions
                const transactionsSnapshot = await db.collection('transactions')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get();
                
                const transactions = transactionsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                const transactionTableBody = document.getElementById('transactionTableBody');
                if (transactions.length === 0) {
                    transactionTableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-gray-500">No transactions found</td>
                        </tr>
                    `;
                } else {
                    transactionTableBody.innerHTML = transactions.map(transaction => `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${transaction.createdAt?.toDate().toLocaleDateString()}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getTransactionTypeColor(transaction.type)}">
                                    ${transaction.type}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${transaction.amount} THB
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusColor(transaction.status)}">
                                    ${transaction.status}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                ${transaction.description}
                            </td>
                        </tr>
                    `).join('');
                }
                
            } catch (error) {
                console.error('Error loading wallet:', error);
            }
        }

        async function loadHistory() {
            if (!currentUser) return;
            
            try {
                const ticketsSnapshot = await db.collection('tickets')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const tickets = ticketsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                const ticketTableBody = document.getElementById('ticketTableBody');
                if (tickets.length === 0) {
                    ticketTableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-4 text-center text-gray-500">No tickets found</td>
                        </tr>
                    `;
                } else {
                    ticketTableBody.innerHTML = tickets.map(ticket => `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${ticket.id.substr(-8)}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                                    ${ticket.number}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${ticket.betAmount} THB
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${ticket.drawDate?.toDate ? ticket.drawDate.toDate().toLocaleDateString() : 'TBD'}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusColor(ticket.status)}">
                                    ${ticket.status}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                ${ticket.prize || '-'}
                            </td>
                        </tr>
                    `).join('');
                }
                
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        async function loadAdminData() {
            if (!isAdmin) return;
            
            try {
                // Load admin stats
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('adminTotalUsers').textContent = usersSnapshot.size;
                
                const ticketsSnapshot = await db.collection('tickets').where('status', '==', 'active').get();
                document.getElementById('adminActiveTickets').textContent = ticketsSnapshot.size;
                
                // Load pending transactions
                loadPendingTransactions();
                
                // Load active banners
                loadActiveBanners();
                
                // Update closed numbers display
                updateClosedNumbersDisplay();
                
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        // Utility Functions
        function getTransactionTypeColor(type) {
            switch(type) {
                case 'deposit': return 'bg-green-100 text-green-800';
                case 'withdrawal': return 'bg-red-100 text-red-800';
                case 'bet': return 'bg-blue-100 text-blue-800';
                case 'win': return 'bg-yellow-100 text-yellow-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusColor(status) {
            switch(status) {
                case 'completed': case 'approved': case 'won': return 'bg-green-100 text-green-800';
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'rejected': case 'lost': return 'bg-red-100 text-red-800';
                case 'active': return 'bg-blue-100 text-blue-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Admin System Functions
        function startNewDraw() {
            if (confirm('Are you sure you want to start a new lottery draw?')) {
                // Implementation for starting new draw
                showNotification('New lottery draw started', 'success');
            }
        }

        function generateResults() {
            if (confirm('Are you sure you want to generate lottery results?')) {
                // Implementation for generating results
                const winningNumber = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                showNotification(`Results generated! Winning number: ${winningNumber}`, 'success');
            }
        }

        function stopSales() {
            if (confirm('Are you sure you want to stop all lottery sales?')) {
                // Implementation for stopping sales
                showNotification('Lottery sales stopped', 'warning');
            }
        }

        function viewAllUsers() {
            showNotification('Loading all users...', 'info');
            // Implementation for viewing all users
        }

        function exportUserData() {
            showNotification('Exporting user data...', 'info');
            // Implementation for exporting data
        }

        function sendNotification() {
            const message = prompt('Enter notification message:');
            if (message) {
                showNotification('Notification sent to all users', 'success');
            }
        }

        function generateDailyReport() {
            showNotification('Generating daily report...', 'info');
            // Implementation for daily report
        }

        function generateMonthlyReport() {
            showNotification('Generating monthly report...', 'info');
            // Implementation for monthly report
        }

        function viewAnalytics() {
            showNotification('Loading analytics...', 'info');
            // Implementation for analytics
        }

        // AI Chat Functions
        function toggleAIChat() {
            const chatBox = document.getElementById('aiChatBox');
            chatBox.classList.toggle('hidden');
        }

        function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage(message, 'user');
                input.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    const responses = [
                        "I can help you with lottery predictions!",
                        "The current jackpot is 500,000 THB.",
                        "Your lucky numbers for today are: 123, 456, 789",
                        "Hot numbers this month: 111, 222, 333",
                        "Remember to bet responsibly!"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addChatMessage(randomResponse, 'ai');
                }, 1000);
            }
        }

        function addChatMessage(message, sender) {
            const messagesDiv = document.getElementById('aiChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' 
                ? 'bg-purple-100 p-3 rounded-lg ml-8' 
                : 'bg-gray-100 p-3 rounded-lg mr-8';
            messageDiv.innerHTML = `<p class="text-sm">${message}</p>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Profile and other utility functions
        function showProfile() {
            showNotification('Profile feature coming soon!', 'info');
        }

        function showWallet() {
            showTab('wallet');
        }

        // Enter key support for AI chat
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.id === 'aiChatInput') {
                sendAIMessage();
            }
        });
    </script>
</body>
</html>
